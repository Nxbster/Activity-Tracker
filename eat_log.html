<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Ben Phillips and Read Schlomer">
  <meta name="description" content="Eating Log screen for the activity tracker webapp">  
  
  <title>Eating Log</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous"> 
  <link rel="stylesheet" type="text/css" href="./styles/eatlogstylesheet.css" />

  <!--Styling Rules in the HTML doc-->
  <style>
    tbody:hover{
      color:orangered;
    }
  </style>

</head>

<body>
    <!--Header inspired by: view-source:https://getbootstrap.com/docs/4.1/examples/pricing/-->
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
      <h3 class="my-0 mr-md-auto font-weight-bold" style="color:black">Akbar's Eating Log</h3>
      <nav class="my-2 my-md-0 mr-md-3">
        <a class="p-2 text-dark" href="eat_log.html">Eating Log</a>
        <a class="p-2 text-dark" href="activity_log.html">Activity Log</a>
        <a class="p-2 text-dark" href="dashboard.html">Dashboard</a>
      </nav>
      <a class="btn btn-outline-secondary" href="#">Log out</a>
    </div>
    <h2 class="page-subheading"> Hello Akbar! &nbsp; What have you eaten today? </h2> </br>

    <form class="form-input" name="activityInput">
      <div class="form-group">
          <label for="meal">Meal: &nbsp;&nbsp;</label>
          <select name="meal" id="meal" required>
              <option disabled selected value> -- select a meal -- </option>
              <option value="breakfast">Breakfast</option>
              <option value="luch">Lunch</option>
              <option value="dinner">Dinner</option>
              <option value="snack">Snack</option>
          </select>


          <label for="eat-date">&nbsp;&nbsp;Date:&nbsp;&nbsp;</label>
          <input type="date" id="eat-date" name="eat-date" required> 
          
          <label for="eat-time">&nbsp;&nbsp;Time: &nbsp;&nbsp;</label>
          <input type="time" id="eat-time" name="eat-time" required ></br>
        </div>

        <div class="input-group input-group-sm mb-3">
          <label for="eat-calories">Calories: </label>
          <input type="text" class="calorie-input" id="eat-calories" name="eat-calories" required><br>
          <div class="input-group-append">
            <span class="input-group-text" id="basic-addon2" >calories</span>
          </div>
        </div>

        <div class="input-group input-group-sm mb-3">
          <label for="eat-sugar">Sugar: </label>
          <input type="text" class="sugar-input" id="eat-sugar" name="eat-sugar" required><br>
          <div class="input-group-append">
            <span class="input-group-text" id="basic-addon2" >grams</span>
          </div>
        </div>

        <label for="eat-comments">Comments: </label> </br>
        <textarea name="eat-comments" id="eat-comments" rows="4" cols="50" placeholder="How was your meal?" required></textarea>

        <input type="button" value="Submit" class="btn btn-secondary" id="input-button"></br></br></br>
    </form>


    <div>
      <h4 style="display:inline;padding-left: 20px;">&nbsp;&nbsp;Recent Meals: </h4>  &nbsp;&nbsp;
        <input type="button" class="btn btn-secondary btn-md" value=" Show Table " id="show-button" title="click to show table">  &nbsp;&nbsp; 
        <input type="button" class="btn btn-secondary btn-md" value=" Hide Table" id="hide-button" title="click to hide table">
    </div> </br> 

    <table id="eat-table" class="table table-striped table-hover">
        <thead class="thead-dark">
          <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Meal</th>
            <th>Calories</th>
            <th>Sugar (mg)</th>
            <th>Comments &nbsp;&nbsp;</th>
          </tr> 
        </thead>
        <tbody>
            <tr>
                <td>2021-03-5</td>
                <td>9:00am</td>
                <td>Breakfast</td>
                <td>340 calories</td>
                <td>12 grams</td>
                <td style="color:white">Bagel with Cream Cheese &nbsp;&nbsp;</td>
            </tr>
            <tr>
                <td>2021-03-6</td>
                <td>1:00pm</td>
                <td>Lunch</td>
                <td>600 calories</td>
                <td>9 grams</td>
                <td style="color:white">Turkey Sandwich w/ Chips &nbsp;&nbsp;</td>
            </tr>
        </tbody>
      </table>  

      <footer>
        <p>&copy; 2021 Ben Phillips and Read Schlomer</p>
      </footer>

        <script>

          //Code to validate types of Calories and Sugar input fields
          function isInt(str){
            var val = parseInt(str);
            return (val > 0);
          }

          function validateInputTypes(){

            //Validate input on the calories and sugar text fields
            var calories = document.getElementById("eat-calories");
            if (!isInt(calories.value)){
              alert("Calories must be inputted as an integer")
              //Delete improper input in Calories and Sugar fields
              document.getElementById("eat-calories").value = "";
              document.getElementById("eat-sugar").value = "";
              return false
            } 

            var sugar = document.getElementById("eat-sugar")
            if (!isInt(sugar.value)){
              alert("Grams of sugar must be inputted as an integer")
              //Delete improper input in Calories and Sugar fields
              document.getElementById("eat-calories").value = "";
              document.getElementById("eat-sugar").value = "";
              return false
            } 
          }

            //Code to add inputted data to below summary table
          var logMeal = function() {
            var date = document.getElementById("eat-date");
            var time = document.getElementById("eat-time");
            var timeFormat = "";
            if (time.value.charAt(0) == '0'){
              timeFormat = time.value.slice(1);
            }
            else{
              timeFormat = time.value;
            }
            var meal = document.getElementById("meal");
            //Uppercase the meal name
            var mealUppercase = meal.value.charAt(0).toUpperCase() + meal.value.slice(1);
            var calories = document.getElementById("eat-calories");
            var sugar = document.getElementById("eat-sugar");
            var comments = document.getElementById("eat-comments");
            
            var eatData = [date.value, timeFormat + "pm", mealUppercase, calories.value + " calories", sugar.value + " grams", comments.value];
            var tableRef = document.getElementById("eat-table");
            var newRow = tableRef.insertRow(tableRef.rows.length);

            //Do not insert if values are null
            if(date.value == "" || time.value == "" || calories.value == "" || sugar.value == "" || meal.value == "" || comments.value == ""){
              return;
            }

            //Do not insert if sugar and calories are not Integers
            if(isInt(sugar.value) == false || isInt(calories.value) == false){
              return;
            }

            var newCell = "";       
            var i = 0;              	      
            while (i < 6)
            {
              newCell = newRow.insertCell(i);            
              newCell.innerHTML = eatData[i];    
              newCell.onmouseover = this.rowIndex; 
              i++;
            }

            //Clear input fields after submission
            document.getElementById("eat-date").value = "";
            document.getElementById("eat-time").value = "";
            document.getElementById("meal").value = "";
            document.getElementById("eat-calories").value = "";
            document.getElementById("eat-sugar").value = "";
            document.getElementById("eat-comments").value = "";
          }


          //Functions to show/hide table on button press
          //Code with help from: https://www.roseindia.net/javascript/javascriptexamples/javascript-show-hide-table.shtml
          function showTable(){
            document.getElementById('eat-table').style.visibility = "visible";
          }
          function hideTable(){
            document.getElementById('eat-table').style.visibility = "hidden";
          }
        
          //Event Listeners to trigger functions
          document.getElementById("input-button").addEventListener("click", validateInputTypes);
          document.getElementById("input-button").addEventListener("click", logMeal);
          document.getElementById("show-button").addEventListener("click", showTable);
          document.getElementById("hide-button").addEventListener("click", hideTable);




        </script>  

</body>